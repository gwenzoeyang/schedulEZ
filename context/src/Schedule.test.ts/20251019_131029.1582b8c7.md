---
timestamp: 'Sun Oct 19 2025 13:10:29 GMT-0400 (Eastern Daylight Time)'
content_id: 1582b8c7dc20cad99d3faaf02dde06c02879f4c2ee832df2df24339f281fff50
---

# file: src/Schedule.test.ts

```typescript
// src/tests/schedule_test.ts
// change imports to include assertRejects
import { assert, assertEquals, assertRejects, assertThrows } from "@std/assert";

import type { Course } from "/Users/gwen-zoeyang/schedulEZ/src/CourseCatalog.ts";
import {
  type AIRecommenderLike,
  Schedule,
} from "/Users/gwen-zoeyang/schedulEZ/src/Schedule.ts";

// Minimal in-memory catalog stub
class CatalogStub {
  constructor(private courses: Course[]) {}
  getById(id: string): Course {
    const c = this.courses.find((x) => x.courseID === id);
    if (!c) {
      throw new Error(`CourseCatalog.getById: courseId "${id}" not found`);
    }
    return c;
  }
  search(): Set<Course> {
    return new Set(this.courses);
  }
}

const C1: Course = {
  courseID: "CS101",
  title: "Intro CS",
  instructor: "Grace Hopper",
  meetingTimes: [{ day: "M", start: "10:00", end: "11:00" }],
  requirements: [[]],
};
const C2: Course = {
  courseID: "CS102",
  title: "DSA",
  instructor: "Ada Lovelace",
  meetingTimes: [{ day: "T", start: "10:00", end: "11:00" }],
  requirements: [[]],
};
const C3: Course = {
  courseID: "CS103",
  title: "Systems",
  instructor: "Ken Thompson",
  meetingTimes: [{ day: "W", start: "10:00", end: "11:00" }],
  requirements: [[]],
};

Deno.test("Schedule.addCourse adds and prevents duplicates", () => {
  const sch = new Schedule(new CatalogStub([C1]), { chooseCourse: () => null });
  const user = { id: "u1" };

  sch.addCourse(user, C1);
  assertEquals(sch.listSchedule(user).size, 1);

  assertThrows(
    () => sch.addCourse(user, C1),
    Error,
    `already in the schedule`,
  );
});

Deno.test("Schedule.listSchedule throws when empty", () => {
  const sch = new Schedule(new CatalogStub([]), { chooseCourse: () => null });
  const user = { id: "u1" };

  assertThrows(
    () => sch.listSchedule(user),
    Error,
    "schedule is empty",
  );
});

Deno.test("Schedule.suggestCourseAI uses AI adapter fallback if Gemini unavailable", async () => {
  // AI stub always picks CS102
  const ai: AIRecommenderLike = {
    chooseCourse: () => C2,
  };
  const sch = new Schedule(new CatalogStub([C1, C2, C3]), ai);
  const user = { id: "u1" };

  sch.setAIPreferences(user, "CS", new Set(["systems"]), new Set());
  const pick = await sch.suggestCourseAI(user);
  assertEquals(pick.courseID, "CS102");
});

Deno.test("Schedule.updateAfterAddAI throws if prefs missing or course not present", async () => {
  const sch = new Schedule(new CatalogStub([C1]), { chooseCourse: () => C1 });
  const user = { id: "u1" };

  // No prefs set
  await assertRejects( // ⬅️ use assertRejects
    () => sch.updateAfterAddAI(user, C1),
    Error,
    "aiPreferences not set",
  );

  // Set prefs but course not in schedule
  sch.setAIPreferences(user, "CS", new Set(), new Set());
  await assertRejects( // ⬅️ use assertRejects
    () => sch.updateAfterAddAI(user, C1),
    Error,
    "is not in the schedule",
  );
});

Deno.test("Schedule.clear removes all courses", () => {
  const sch = new Schedule(new CatalogStub([C1, C2]), {
    chooseCourse: () => null,
  });
  const user = { id: "u1" };

  sch.addCourse(user, C1);
  sch.addCourse(user, C2);
  assertEquals(sch.listSchedule(user).size, 2);

  sch.clear(user);
  assertThrows(() => sch.listSchedule(user), Error, "schedule is empty");
});

```
